function refreshDownloadType(){finalData.fileExType=$(".download-formats option:selected").data("filext");finalData.requestType=$(".download-formats option:selected").val()}function showModalAccountMessage(){var n=$("#mainModal"),t=$.i18n("$modal_accountName")+" - "+loginData.name+"\n\r"+$.i18n("$modal_accountLongName")+" - "+loginData.longName+"\n\r"+$.i18n("$modal_accountShortName")+" - "+loginData.shortName+"\n\r"+$.i18n("$modal_accountMail")+" - "+loginData.email+"\n\r"+$.i18n("$modal_accountTimeZone")+" - "+loginData.timeZone+"\n\r"+$.i18n("$modal_accountLanguage")+" - "+loginData.language+"";n.find(".modal-body").text(t);n.find(".modal-title").text($.i18n("$modal_accountTitle"));n.modal("show")}function getCalendarHeight(){var n=672,t=$(window).height()-268;return $(window).height()<=n?n:t}function getListHeight(){var n=466,t=$(window).height()-n;return $(window).height()<=672?n-4:t/1.2}function ajaxSuccess(){$(".main").removeClass("scale-to-background");$("#modal-login div").fadeOut(123);$("#modal-small").hide().animate({easing:"easeOutQuint",duration:300,queue:!1});$(".main").animate({opacity:1,easing:"easeOutQuint",width:"100%",queue:!1,height:"100%",top:0},function(){$(".selectpicker").selectpicker();$("#div_loading").hide();$(".searchable").multiSelect({selectableHeader:"<input type='text' class='search-input' placeholder='&#xF002;'>",selectionHeader:"<input type='text' class='search-input' placeholder='&#xF002;'>",selectableFooter:"<div data-i18n='$vehicle_picker_search_from' class='custom-header'>...<\/div>",selectionFooter:"<div data-i18n='$vehicle_picker_search_to' class='custom-header'>...<\/div>",afterInit:function(){var n=this,t=n.$selectableUl.prev(),i=n.$selectionUl.prev(),r="#"+n.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",u="#"+n.$container.attr("id")+" .ms-elem-selection.ms-selected";n.qs1=t.quicksearch(r).on("keydown",function(t){if(t.which===40)return n.$selectableUl.focus(),!1});n.qs2=i.quicksearch(u).on("keydown",function(t){if(t.which===40)return n.$selectionUl.focus(),!1});finalData.deviceList=$("#device-list").val();$(".ms-selectable").after('<div class="select-flip"><i id="flipItemList" class="fa fa-2x fa-exchange" aria-hidden="true"><\/i><\/div>');$("#flipItemList").click(function(){allSelected===!1?(allSelected=!0,$(".searchable").multiSelect("select_all")):(allSelected=!1,$(".searchable").multiSelect("deselect_all"))})},afterSelect:function(){this.qs1.cache();this.qs2.cache();finalData.deviceList=$("#device-list").val()},afterDeselect:function(){this.qs1.cache();this.qs2.cache();finalData.deviceList=$("#device-list").val()}});$(window).resize(function(){$("#calendar").fullCalendar("option","height",getCalendarHeight());var n=$(".ms-list");n.each(function(n,t){t.setAttribute("style","height: "+getListHeight()+"px; !important")})});updateText();$("#calendar").fullCalendar({defaultDate:"2017-01-01",locale:$(".language option:selected").val(),longPressDelay:50,height:getCalendarHeight(),eventLimit:!0,header:{left:"prev,next",center:"title",right:"resetButton,today"},defaultView:"month",customButtons:{resetButton:{text:$.i18n("$mainapp_calendar_reset_button"),"class":"btn-danger",click:function(){$("#calendar").fullCalendar("removeEventSources");requestArray=[];finalData.dateList=requestArray;showModalMessage($.i18n("$modal_calendar_reset_text"))}}},events:[],selectable:!0,selectHelper:!0,select:function(n,t){var u=moment().diff(n,"days",!0),f=t.clone(),e=moment().diff(f.subtract(1,"days"),"days",!0),r=-1,i;if(u<r||e<r)return $("#calendar").fullCalendar("unselect"),showModalMessage($.i18n("$modal_calendar_date_futurelimit")),!1;var o=moment(n),s=moment(t),h=s.diff(o,"days"),c=requestArray.length+h;if(requestArray.length<=dayLimit&&c<=dayLimit){for(i=moment(n);i.isBefore(t);i.add(1,"days"))requestArray.push(new moment(i));$("#calendar").fullCalendar("addEventSource",[{start:n,end:t,rendering:"background",block:!0}])}else showModalMessage($.i18n("$modal_calendar_date_limit"));$("#calendar").fullCalendar("unselect")},selectOverlap:function(n){var i,t;for($("#calendar").fullCalendar("removeEventSource",n.source),i=moment(n.start);i.isBefore(n.end);i.add(1,"days"))for(t=0;t<finalData.dateList.length;t++)if(finalData.dateList[t].isSame(i)){finalData.dateList.splice(t,1);break}return!n.block}});$(window).mouseup(function(){$("body").removeClass("fc-not-allowed")});$(".ms-list").each(function(n,t){t.setAttribute("style","height: "+getListHeight()+"px; !important")});$("#calendar").fullCalendar("today");refreshDownloadType()})}function ajaxFailure(n){var t=n.responseText;showModalMessage($.i18n("$modal_ajax_error")+"Code - ["+n.ErrorCode+"] "+t)}function switchUiLockState(){return $("#downloadButton").prop("disabled")||$("#downloadButton").prop("disabled")?($("#downloadButton").prop("disabled",!1),$("#formatListId").prop("disabled",!1),$("body").css("cursor","default"),!1):($("#downloadButton").prop("disabled",!0),$("#formatListId").prop("disabled",!0),$("body").css("cursor","progress"),!0)}function sendRequesttoServer(n){var t,i;finalData.requestType=n;switchUiLockState();finalData.dateList.length>0&&finalData.deviceList!==null?(finalData.dateList.sortBy(function(n){return n.date}),t=new Date(finalData.dateList[0]),t=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),i=new Date(finalData.dateList[finalData.dateList.length-1]),i=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate(),xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){if(xhttp.readyState===4&&xhttp.status===200){var n=new Blob([xhttp.response],{type:xhttp.response.type});saveAs(n,loginData.name+"-("+t+" - "+i+")-"+finalData.fileExType+".zip");switchUiLockState()}xhttp.readyState===4&&xhttp.status!==200&&(xhttp.status===408?showModalMessage($.i18n("$modal_session_expired")):showModalMessage($.i18n("$modal_ajax_error")+"\nCode: "+xhttp.status),$("#mainModal").visibilityChanged({callback:function(n,t){t===!1&&(location.href="/")},runOnLoad:!1,frequency:100}))},xhttp.open("POST","/Home/DataRequest"),xhttp.setRequestHeader("Content-Type","application/json"),xhttp.responseType="blob",xhttp.send(JSON.stringify(finalData))):(switchUiLockState(),showModalMessage($.i18n("$modal_vehiclepicker_all_notselected")))}function sortBy(n){for(var r,i,t=this.length;t;)r=this[--t],this[t]=[].concat(n.call(r,r,t),r);for(this.sort(function(n,t){for(var i=0,r=n.length;i<r;++i)if(n[i]!==t[i])return n[i]<t[i]?-1:1;return 0}),i=this.length;i;)this[--i]=this[i][this[i].length-1];return this}$(function(){if(typeof Object.defineProperty=="function")try{Object.defineProperty(Array.prototype,"sortBy",{value:sortBy})}catch(n){console.log(n.toString())}Array.prototype.sortBy||(Array.prototype.sortBy=sortBy);$(".language").on("change",function(){this.value&&$("#calendar").fullCalendar("option","locale",this.value)});$("#accountButton").click(function(){showModalAccountMessage()});$(".download-formats").on("change keyup",refreshDownloadType);$("#header-meta").removeClass("hidden");$("#headerInfoName").text(loginData.longName)});